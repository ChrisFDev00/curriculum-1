<div class="c-map">
  <h1 class="e-heading c-map__start is-none--lt-container">👉🏾</h1>
  <div style="height: 200px; clear: both;"></div>

  {{ $taxonomy_to_map := .Params.taxonomy_to_map }}

  {{/* You can't ask for a taxonomy to be sorted by weight, so we need to get weights and iterate ourselves - see https://discourse.gohugo.io/t/list-custom-taxonomy-terms-in-a-specific-order-not-alphabetical/18145/5 */}}
  {{ $taxonomy := $.Site.GetPage (printf "/%s" $taxonomy_to_map) }}
  {{ range $termPage := $taxonomy.Pages.ByWeight }}
    {{ $termName := $termPage.Name }}
    {{ $termTitle := $termPage.Params.Title }}
    {{ $values := index (index site.Taxonomies $taxonomy_to_map) $termName }}
    <section class="c-map__block">
      <h2 class="e-heading c-map__title">
        {{ $termTitle }}
      </h2>
      {{ $termPage.Params.Description }}

      {{ if $termPage.Params.details}}
      <dl>
        {{ range $details := $termPage.Params.details}}
        <dt>{{ $details.name }}</dt>
        <dd>{{ $details.value }}</dd>
        {{ end }}
      </dl>
      {{ end }}
      <ol class="c-map__timeline">
        {{/* Check if a menu for the current map section exists */}}
        {{ if $values }}
          {{/* Range over the items in the menu */}}
          {{ range $iterator, $value := $values }}
            <li
              class="c-map__stop"
              style="--layer:{{ sub (len $values) (add $iterator 1) }}">
              {{ partial "card.html" $value.Page }}
            </li>
          {{ end }}
        {{ else }}
          <li>No items found for {{ $termTitle }}</li>
        {{ end }}
      </ol>
    </section>
  {{ end }}
</div>
